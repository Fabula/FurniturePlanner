<?xml version="1.0" encoding="utf-8"?>
<s:Panel xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx"
		 width = "400">

	<fx:Metadata>
		[Event(name = "accountCreate", type = "events.AccountCreateEvent")]
	</fx:Metadata>
	<fx:Script>
		<![CDATA[
			import events.AccountCreateEvent;
			
			import mx.controls.Alert;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			[Bindable]
			public var serverAddress:String = new String("http://localhost:3000/users.xml");
			
			protected function authorizationService_resultHandler(event:ResultEvent):void
			{
				var result:Object = event.result;
				
				if (result == "error"){
					Alert.show("Ошибка при создании учетной записи", "Ошибка");
				}
				else{
					dispatchEvent(new AccountCreateEvent(XML(result)));
					clearForm();
				}
			}
			
			private function clearForm():void{
				userLogin.text = '';
				userEmail.text = '';
				userName.text = '';
				userSurName.text = '';
				userPassword.text = '';
				userPasswordConfirmation.text = '';
			}
			
						
			protected function authorizationService_faultHandler(event:FaultEvent):void
			{
				Alert.show(event.fault.faultString, "Информация об ошибке");
				
			}

			protected function registration_clickHandler(event:MouseEvent):void
			{
				authorizationService.send();
				registrationButton.enabled = false;
			}

		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<s:HTTPService id = "authorizationService"
					   url = "{serverAddress}"
					   contentType="application/xml"
					   method="POST" 
					   resultFormat="e4x"
					   result="authorizationService_resultHandler(event)"
					   fault="authorizationService_faultHandler(event)">
			<s:request xmlns="">
				<user>
					<login>{userLogin.text}</login>
					<email>{userEmail.text}</email>
					<name>{userName.text}</name>
					<last_name>{userSurName.text}</last_name>
					<telephone_number>{telephoneNumber.text}</telephone_number>
					<password>{userPassword.text}</password>
					<password_confirmation>{userPasswordConfirmation.text}</password_confirmation>
				</user>
			</s:request>
		</s:HTTPService>
	</fx:Declarations>
	<s:layout>
		<s:VerticalLayout horizontalAlign="center"
						  gap="15"
						  paddingTop="15" paddingLeft="15" paddingRight="15" paddingBottom="15"/>
	</s:layout>
	<s:VGroup horizontalAlign="center" width="100%" height="100%">
		<mx:Form id="regForm">
			<mx:FormItem id="regFormItem"
				label="Логин:"
				 required="true">
				<s:TextInput id="userLogin"/> 
			</mx:FormItem>
			<mx:FormItem 
				label="Эл. почта:"
				required="true">
				<s:TextInput id="userEmail"/>
			</mx:FormItem>
			<mx:FormItem 
				label="Имя:"
				required="true">
				<s:TextInput id="userName"/>
			</mx:FormItem>
			<mx:FormItem 
				label="Фамилия:"
				required="true">
				<s:TextInput id="userSurName"/>
			</mx:FormItem>
			<mx:FormItem label="Номер телефона:">
				<s:TextInput id="telephoneNumber" />
			</mx:FormItem>
			<mx:FormItem 
				label="Пароль:"
				required="true">
				<s:TextInput 
					id="userPassword"
					displayAsPassword="true"/>
			</mx:FormItem>
			<mx:FormItem 
				label="Повторите пароль:"
				required="true">
				<s:TextInput 
					id="userPasswordConfirmation"
					displayAsPassword="true"/>
			</mx:FormItem>
		</mx:Form>
		<s:HGroup>
			<s:Button 
				id = "registrationButton" 
				label = "Создать" 
				click="registration_clickHandler(event)"/>
		</s:HGroup>
	</s:VGroup>	
</s:Panel>
